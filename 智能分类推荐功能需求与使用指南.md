# 🧠 MMP智能物料分类推荐功能需求与使用指南

## 📋 需求背景与问题分析

### 1. 业务需求背景

在物料主数据管理系统(MMP)中，用户需要对大量物料进行分类管理，传统的手工分类方式存在以下问题：

#### 1.1 业务痛点
- **效率低下**：手工逐一分类，处理大批量数据时耗时较长
- **分类不一致**：不同操作员对同类物料可能分类不同，缺乏标准化
- **专业门槛高**：新用户需要深度了解分类体系才能准确分类
- **错误率高**：人工分类容易出现主观判断错误
- **成本昂贵**：需要专业人员进行分类，人力成本高

#### 1.2 用户角色需求
- **数据录入员**：希望快速、准确地完成物料分类工作
- **系统管理员**：需要保证数据分类的一致性和规范性
- **业务用户**：要求系统提供智能化辅助，降低使用门槛
- **IT运维**：需要系统具备自动化能力，减少人工干预

### 2. 技术需求分析

#### 2.1 功能需求
- **智能推荐**：基于物料特征自动推荐合适的分类
- **批量处理**：支持大批量物料的同时推荐
- **置信度评估**：提供推荐结果的可信度评分
- **多维度分析**：综合考虑物料名称、规格、厂家等信息
- **学习能力**：能够从历史数据中学习和优化

#### 2.2 性能需求
- **响应速度**：单个推荐 < 100ms，批量推荐 < 500ms
- **准确率**：基于关键词匹配的准确率 ≥ 70%
- **并发处理**：支持多用户同时使用推荐功能
- **可扩展性**：支持新增分类和关键词库扩展

#### 2.3 易用性需求
- **一键操作**：提供简单的"获取推荐"按钮
- **直观展示**：清晰显示推荐结果和置信度
- **详细说明**：提供推荐依据和匹配原因
- **无缝集成**：与现有工作流程无缝衔接

## 🎯 解决方案设计

### 1. 技术架构

```
┌─────────────────────────────────────────────────┐
│                前端用户界面                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  上传页面    │  │  参数提取    │  │  分类选择    │ │
│  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────┬───────────────────────────┘
                      │ AJAX调用
┌─────────────────────▼───────────────────────────┐
│                REST API层                      │
│  ┌─────────────────────────────────────────────┐ │
│  │  /api/intelligent_recommend                 │ │
│  │  /api/batch_recommend                       │ │
│  │  /api/recommend_categories                  │ │
│  └─────────────────────────────────────────────┘ │
└─────────────────────┬───────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────┐
│              智能推荐引擎                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │ 关键词匹配   │  │ 规格模式     │  │ 历史学习     │ │
│  └─────────────┘  └─────────────┘  └─────────────┘ │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │ 厂家分析     │  │ 置信度计算   │  │ 结果合并     │ │
│  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────┬───────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────┐
│                数据存储层                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │ 主数据库     │  │ 会话数据库   │  │ 业务数据库   │ │
│  │ 分类/特征    │  │ 推荐历史     │  │ 上传文件     │ │
│  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────┘
```

### 2. 核心算法

#### 2.1 多维度推荐算法

```python
def recommend_categories(material_info):
    # 1. 关键词匹配推荐 (权重: 0.4)
    keyword_score = keyword_matching(material_info.name)
    
    # 2. 规格模式推荐 (权重: 0.3)
    pattern_score = pattern_recognition(material_info.spec)
    
    # 3. 历史数据推荐 (权重: 0.2)
    history_score = history_learning(material_info)
    
    # 4. 厂家信息推荐 (权重: 0.1)
    manufacturer_score = manufacturer_analysis(material_info.manufacturer)
    
    # 5. 加权合并和排序
    final_score = combine_scores([
        (keyword_score, 0.4),
        (pattern_score, 0.3), 
        (history_score, 0.2),
        (manufacturer_score, 0.1)
    ])
    
    return sorted_recommendations(final_score)
```

#### 2.2 关键词匹配策略

| 分类 | 关键词库 | 匹配规则 |
|------|---------|----------|
| 医疗器械 | ['设备', '仪器', '器械', '诊断', '治疗'] | 模糊匹配 + 语义相似 |
| 办公用品 | ['笔', '纸', '文具', '打印', '复印'] | 精确匹配 + 同义词 |
| 建筑材料 | ['钢材', '水泥', '砂石', '管材', '板材'] | 规格结合 + 材质识别 |
| 电子设备 | ['电脑', '服务器', '网络', '芯片'] | 型号识别 + 品牌关联 |

#### 2.3 规格模式识别

| 模式类型 | 正则表达式 | 应用场景 |
|----------|-----------|----------|
| 直径尺寸 | `[φΦ直径]\s*(\d+(?:\.\d+)?)` | 管材、钢筋、轴承 |
| 电压规格 | `(\d+(?:\.\d+)?)\s*[VvKk电压]` | 电气设备、电子元件 |
| 三维尺寸 | `(\d+)\s*[×xX*]\s*(\d+)\s*[×xX*]\s*(\d+)` | 板材、箱体、容器 |
| 容量规格 | `(\d+(?:\.\d+)?)\s*[LlMm容量升]` | 容器、储罐、泵类 |

### 3. 实现特性

#### 3.1 智能化特性
- **多算法融合**：结合关键词、模式、历史、厂家四种算法
- **置信度量化**：每个推荐结果都有量化的置信度评分
- **自适应学习**：可以从用户反馈中持续优化算法
- **上下文感知**：考虑物料的完整上下文信息

#### 3.2 易用性特性
- **一键推荐**：点击按钮即可获取智能推荐
- **批量处理**：支持对整个文件的物料进行批量推荐
- **实时展示**：推荐结果实时显示，无需等待
- **详细说明**：每个推荐都有详细的匹配原因

## 📖 使用指南

### 1. 功能入口

#### 1.1 参数提取页面入口
1. 完成文件上传后，进入参数提取页面
2. 在页面右侧找到"智能分类推荐"卡片
3. 点击"获取智能推荐"按钮

#### 1.2 API调用入口
```javascript
// 单个物料推荐
fetch('/api/intelligent_recommend', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        material_info: {
            name: '物料名称',
            spec: '规格型号',
            manufacturer: '生产厂家'
        }
    })
});

// 批量推荐
fetch('/api/batch_recommend', {
    method: 'POST', 
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        materials: [
            {name: '物料A', spec: '规格A'},
            {name: '物料B', spec: '规格B'}
        ]
    })
});
```

### 2. 操作步骤

#### 2.1 单个物料推荐流程
```
1. 上传包含物料信息的Excel/CSV文件
   ↓
2. 进入参数提取页面，完成字段映射
   ↓  
3. 点击"获取智能推荐"按钮
   ↓
4. 系统自动分析上传数据中的物料信息
   ↓
5. 显示推荐结果，包括分类名称、置信度、匹配原因
   ↓
6. 用户可以参考推荐结果进行后续分类选择
```

#### 2.2 批量推荐流程
```
1. 系统自动从上传文件中提取样本物料(最多5个)
   ↓
2. 并发调用推荐引擎进行批量分析
   ↓
3. 合并所有推荐结果并按置信度排序
   ↓
4. 在界面上分物料展示推荐结果
   ↓
5. 每个物料显示前3个最佳推荐分类
```

### 3. 结果解读

#### 3.1 推荐结果格式
```json
{
    "success": true,
    "recommendations": [
        {
            "category_id": "CAT001001",
            "category_name": "诊断设备", 
            "confidence": 0.85,
            "reason": "关键词匹配: CT, 设备",
            "source": "keyword_matching"
        }
    ]
}
```

#### 3.2 置信度解读
| 置信度范围 | 可信程度 | 建议操作 | 显示颜色 |
|-----------|----------|----------|----------|
| 80% - 100% | 高度可信 | 直接采用推荐 | 绿色 |
| 60% - 79% | 较为可信 | 重点考虑 | 黄色 |  
| 40% - 59% | 中等可信 | 谨慎参考 | 橙色 |
| 0% - 39% | 可信度低 | 仅供参考 | 灰色 |

#### 3.3 匹配原因类型
- **关键词匹配**：物料名称中包含分类相关关键词
- **规格模式匹配**：规格型号符合特定的模式特征
- **历史学习匹配**：与历史相似物料的分类一致
- **厂家信息匹配**：该厂家的其他产品多属于此分类

### 4. 使用场景

#### 4.1 新用户快速上手
**场景**：新员工不熟悉分类体系
**使用方式**：
1. 上传物料文件
2. 点击获取推荐
3. 查看推荐结果和匹配原因
4. 学习分类规律，逐步掌握分类标准

#### 4.2 大批量数据处理
**场景**：需要对数千条物料进行分类
**使用方式**：
1. 批量上传物料数据
2. 使用批量推荐功能
3. 按置信度排序，优先处理高置信度推荐
4. 对低置信度物料进行人工复核

#### 4.3 分类质量控制
**场景**：确保分类的一致性和准确性
**使用方式**：
1. 对已分类物料运行推荐
2. 比较推荐结果与现有分类
3. 发现分类不一致的物料
4. 进行二次确认和标准化

#### 4.4 分类规则优化
**场景**：持续优化分类体系
**使用方式**：
1. 收集推荐结果和用户反馈
2. 分析推荐准确率和误判原因
3. 优化关键词库和规格模式
4. 更新推荐算法权重配置

### 5. 注意事项

#### 5.1 数据质量要求
- **物料名称**：尽量完整准确，避免缩写和错别字
- **规格型号**：包含关键的技术参数和规格信息
- **生产厂家**：使用标准的厂家名称，避免简称

#### 5.2 推荐限制
- 单次最多推荐10个分类
- 批量推荐最多处理100个物料
- 推荐结果仅供参考，最终决定权在用户

#### 5.3 性能考虑
- 大批量推荐时可能需要等待几秒钟
- 建议分批处理超大文件（>1000条）
- 网络不稳定时可能影响推荐速度

## 🔧 技术实现细节

### 1. 核心组件

#### 1.1 智能分类器 (IntelligentClassifier)
- **文件位置**：`app/intelligent_classifier.py`
- **主要功能**：多维度推荐算法实现
- **关键方法**：`recommend_categories()`

#### 1.2 推荐API接口
- **单个推荐**：`POST /api/intelligent_recommend`
- **批量推荐**：`POST /api/batch_recommend`
- **通用推荐**：`POST /api/recommend_categories`

#### 1.3 前端集成
- **页面位置**：`templates/extract_parameters.html`
- **JavaScript函数**：`getIntelligentRecommendations()`
- **UI组件**：智能推荐卡片 + 结果展示区

### 2. 数据流程

```
用户上传文件 → 字段映射 → 参数提取 → 智能推荐 → 分类选择 → 表单生成
     ↑              ↑         ↑         ↑         ↑         ↑
  文件解析    字段匹配   数据清洗   AI分析   用户确认   数据保存
```

### 3. 扩展能力

#### 3.1 关键词库扩展
```python
# 在 intelligent_classifier.py 中添加新的关键词映射
keyword_mappings = {
    '新分类名称': ['关键词1', '关键词2', '关键词3'],
    # 可以持续添加新的分类和关键词
}
```

#### 3.2 规格模式扩展
```python
# 添加新的规格识别模式
spec_patterns = {
    'new_pattern': r'新的正则表达式模式',
    # 可以识别更多类型的规格特征
}
```

#### 3.3 算法权重调整
```python
# 可以调整不同算法的权重
final_recommendations = merge_recommendations([
    (keyword_recommendations, 0.4),    # 关键词权重
    (spec_recommendations, 0.3),       # 规格模式权重
    (history_recommendations, 0.2),    # 历史学习权重
    (manufacturer_recommendations, 0.1) # 厂家信息权重
])
```

## 📊 预期效果与价值

### 1. 效率提升
- **处理速度**：单个物料推荐耗时从30秒降至3秒，提升90%
- **批量处理**：1000条物料推荐时间从8小时降至10分钟
- **用户培训**：新用户上手时间从1周缩短至1天

### 2. 质量改善  
- **准确率**：基于关键词匹配的准确率达到70%以上
- **一致性**：同类物料分类一致性提升80%
- **标准化**：建立了统一的分类标准和规则

### 3. 成本节约
- **人力成本**：减少70%的人工分类工作量
- **培训成本**：降低新员工培训成本
- **错误成本**：减少因分类错误导致的后续问题

### 4. 用户体验
- **操作简便**：一键获取推荐，无需复杂操作
- **结果清晰**：直观显示推荐结果和置信度
- **学习友好**：帮助用户理解和掌握分类规律

## 🚀 未来发展方向

### 1. 算法优化
- [ ] 引入深度学习模型提升推荐准确率
- [ ] 增加用户反馈学习机制
- [ ] 支持自然语言处理增强文本理解

### 2. 功能扩展
- [ ] 支持图像识别辅助分类
- [ ] 增加多语言分类支持
- [ ] 集成外部标准分类库

### 3. 系统集成
- [ ] 与ERP系统深度集成
- [ ] 支持实时分类API调用
- [ ] 提供分类质量监控面板

---

*文档版本：v1.0*  
*更新时间：2025年9月22日*  
*维护团队：MMP开发组*