{% extends "base.html" %}

{% block title %}é€‰æ‹©åˆ†ç±»æ¨¡æ¿ - MMPæ™ºèƒ½ç‰©æ–™ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block head %}
<script>
// å†…è”JavaScriptç¡®ä¿å‡½æ•°åœ¨é¡µé¢åŠ è½½å‰å°±å®šä¹‰
function showStatDetails(type) {
    console.log('showStatDetailsè¢«è°ƒç”¨:', type, '- è·³è½¬åˆ°åˆ†ç±»ç®¡ç†é¡µé¢');
    
    // è·³è½¬åˆ°åˆ†ç±»ç®¡ç†é¡µé¢æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
    let targetUrl = '/categories';
    
    // æ ¹æ®ç±»å‹æ·»åŠ ç›¸åº”çš„ç­›é€‰å‚æ•°æˆ–é”šç‚¹
    switch(type) {
        case 'total':
            // æ˜¾ç¤ºæ‰€æœ‰åˆ†ç±»
            console.log('è·³è½¬åˆ°åˆ†ç±»ç®¡ç†é¡µé¢ - æŸ¥çœ‹å…¨éƒ¨åˆ†ç±»');
            break;
        case 'levels':
            // å¯ä»¥æ·»åŠ å±‚çº§è¯´æ˜çš„ç‰¹æ®Šæ ‡è¯†
            targetUrl += '#levels';
            console.log('è·³è½¬åˆ°åˆ†ç±»ç®¡ç†é¡µé¢ - æŸ¥çœ‹å±‚çº§ç»“æ„');
            break;
        case 'level1':
            // ç­›é€‰åªæ˜¾ç¤ºä¸€çº§åˆ†ç±»  
            targetUrl += '?level=1';
            console.log('è·³è½¬åˆ°åˆ†ç±»ç®¡ç†é¡µé¢ - æŸ¥çœ‹ä¸€çº§åˆ†ç±»');
            break;
        case 'compatibility':
            // æ˜¾ç¤ºé€‚é…åº¦ç›¸å…³ä¿¡æ¯
            targetUrl += '#compatibility';
            console.log('è·³è½¬åˆ°åˆ†ç±»ç®¡ç†é¡µé¢ - æŸ¥çœ‹é€‚é…åº¦ä¿¡æ¯');
            break;
    }
    
    // åœ¨æ–°çª—å£ä¸­æ‰“å¼€åˆ†ç±»ç®¡ç†é¡µé¢
    window.open(targetUrl, '_blank');
}

function testAlert() {
    alert('ç‚¹å‡»åŠŸèƒ½æ­£å¸¸ï¼JavaScriptå¯ä»¥æ‰§è¡Œã€‚');
}

// ç¡®ä¿å‡½æ•°å…¨å±€å¯ç”¨
window.showStatDetails = showStatDetails;
window.testAlert = testAlert;

console.log('å†…è”JavaScriptåŠ è½½å®Œæˆ');
</script>
<style>
    :root {
        --primary-color: #2c3e50;
        --secondary-color: #3498db;
        --success-color: #27ae60;
        --warning-color: #f39c12;
        --info-color: #17a2b8;
        --light-bg: #f8f9fa;
        --border-color: #dee2e6;
        --text-muted: #6c757d;
        --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        --shadow-md: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        --border-radius: 0.375rem;
    }
    
    .template-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: var(--border-radius);
    }
    
    .template-selection-card {
        background: linear-gradient(135deg, #f8f9ff 0%, #e8f4f8 100%);
        border: 2px solid var(--secondary-color);
        border-radius: var(--border-radius);
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow-md);
    }
    
    .template-info h4 {
        color: var(--primary-color);
        margin-bottom: 1rem;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .template-stats {
        margin-bottom: 1rem;
    }
    
    .template-stats .badge {
        margin-right: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--secondary-color);
        color: white;
        border-radius: 50px;
        font-size: 0.9rem;
    }
    
    .template-description {
        color: var(--text-muted);
        margin-bottom: 1.5rem;
        line-height: 1.6;
    }
    
    .template-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
    }
    
    .template-actions .btn {
        padding: 1rem 2rem;
        font-size: 1.1rem;
        border-radius: var(--border-radius);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        text-align: center;
        border-left: 4px solid var(--secondary-color);
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-left-width: 6px;
    }
    
    .stat-card h3 {
        font-size: 2rem;
        font-weight: bold;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }
    
    .stat-card p {
        color: var(--text-muted);
        margin: 0;
        font-size: 0.9rem;
    }
    
    .stat-card.success {
        border-left-color: var(--success-color);
    }
    
    .stat-card.success h3 {
        color: var(--success-color);
    }
    
    .compatibility-info {
        background: white;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        margin-bottom: 2rem;
    }
    
    .compatibility-info h5 {
        color: var(--primary-color);
        margin-bottom: 1rem;
    }
    
    .compatibility-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .preview-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        padding: 1.5rem;
    }
    
    .category-tree {
        max-height: 500px;
        overflow-y: auto;
    }
    
    .category-item {
        padding: 0.5rem 0;
        border-bottom: 1px solid #f1f3f4;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .category-code {
        font-weight: bold;
        color: var(--primary-color);
        min-width: 60px;
    }
    
    .category-name {
        color: var(--text-muted);
    }
    
    .stat-card .detail-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--secondary-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .stat-card:hover .detail-btn {
        opacity: 1;
    }
    
    .stat-details-modal .modal-content {
        border-radius: var(--border-radius);
        border: none;
        box-shadow: var(--shadow-md);
    }
    
    .stat-details-modal .modal-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-bottom: none;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }
    
    .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f1f3f4;
    }
    
    .detail-item:last-child {
        border-bottom: none;
    }
    
    .detail-label {
        font-weight: 600;
        color: var(--primary-color);
    }
    
    .detail-value {
        color: var(--text-muted);
        font-size: 1.1rem;
    }
    
    .progress-item {
        margin-bottom: 1rem;
    }
    
    .progress-item .progress {
        height: 8px;
        background-color: #f8f9fa;
        border-radius: 4px;
    }
    
    .progress-item .progress-bar {
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="template-header text-center">
        <h2><i class="fas fa-tags"></i> é€‰æ‹©åˆ†ç±»æ¨¡æ¿</h2>
        <p>é€‰æ‹©é€‚åˆçš„åˆ†ç±»æ¨¡æ¿è¿›è¡Œæ™ºèƒ½åˆ†ç±»ï¼Œç³»ç»Ÿå°†æ ¹æ®æ‚¨çš„é€‰æ‹©è¿›è¡Œåç»­å¤„ç†</p>
        <!-- æµ‹è¯•æŒ‰é’® -->
        <button onclick="testAlert()" class="btn btn-sm btn-warning">æµ‹è¯•ç‚¹å‡»åŠŸèƒ½</button>
    </div>

    <!-- æ¨¡æ¿é€‰æ‹©å¡ç‰‡ -->
    <div class="template-selection-card">
        <div class="row">
            <div class="col-lg-8">
                <div class="template-info">
                    <h4>
                        <i class="fas fa-industry"></i>
                        å·¥ä¸šåˆ¶é€ ä¸šæ ‡å‡†åˆ†ç±»ä½“ç³»
                    </h4>
                    <div class="template-stats">
                        <span class="badge">548ä¸ªåˆ†ç±»</span>
                        <span class="badge">3å±‚çº§ç»“æ„</span>
                        <span class="badge">åˆ¶é€ ä¸šå…¨é¢†åŸŸ</span>
                        <span class="badge" style="background-color: var(--text-muted);">æ›´æ–°äº 2025-09-25</span>
                    </div>
                    <p class="template-description">
                        ğŸ’¡ æ­¤åˆ†ç±»ä½“ç³»æ¶µç›–åŒ–å·¥ã€æœºæ¢°è®¾å¤‡ã€é‡‘å±åˆ¶å“ã€å»ºæã€å·¥å…·ç­‰åˆ¶é€ ä¸šå…¨é¢†åŸŸï¼Œ
                        åŒ…å«å®Œæ•´çš„3å±‚çº§åˆ†ç±»ç»“æ„ï¼Œé€‚ç”¨äºå·¥ä¸šä¼ä¸šçš„ç‰©æ–™åˆ†ç±»ç®¡ç†ã€é‡‡è´­åˆ†ç±»ã€åº“å­˜ç®¡ç†ç­‰åœºæ™¯ã€‚
                        <br><strong>è¦†ç›–é¢†åŸŸï¼š</strong>åŒ–å·¥ä¸‰å‰‚ã€æœºæ¢°è®¾å¤‡ã€é‡‘å±åˆ¶å“ã€å»ºå·¥ææ–™ã€å·¥å™¨å…·ç­‰18ä¸ªä¸»è¦ç±»åˆ«ã€‚
                    </p>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <div class="template-actions">
                    <button class="btn btn-outline-info" id="previewBtn">
                        <i class="fas fa-eye"></i> é¢„è§ˆç»“æ„
                    </button>
                    <button class="btn btn-success btn-lg" id="selectTemplateBtn">
                        <i class="fas fa-check"></i> ä½¿ç”¨æ­¤æ¨¡æ¿
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯æ¦‚è§ˆ -->
    <div class="stats-overview">
        <div class="stat-card" data-stat-type="total" onclick="showStatDetails('total')">
            <button class="detail-btn" title="æŸ¥çœ‹è¯¦æƒ…" onclick="showStatDetails('total'); event.stopPropagation();">
                <i class="fas fa-info"></i>
            </button>
            <h3 id="totalCategories">548</h3>
            <p>æ€»åˆ†ç±»æ•°</p>
        </div>
        <div class="stat-card" data-stat-type="levels" onclick="showStatDetails('levels')">
            <button class="detail-btn" title="æŸ¥çœ‹è¯¦æƒ…" onclick="showStatDetails('levels'); event.stopPropagation();">
                <i class="fas fa-info"></i>
            </button>
            <h3>3</h3>
            <p>å±‚çº§æ·±åº¦</p>
        </div>
        <div class="stat-card" data-stat-type="level1" onclick="showStatDetails('level1')">
            <button class="detail-btn" title="æŸ¥çœ‹è¯¦æƒ…" onclick="showStatDetails('level1'); event.stopPropagation();">
                <i class="fas fa-info"></i>
            </button>
            <h3 id="level1Count">18</h3>
            <p>ä¸€çº§åˆ†ç±»</p>
        </div>
        <div class="stat-card success" data-stat-type="compatibility" onclick="showStatDetails('compatibility')">
            <button class="detail-btn" title="æŸ¥çœ‹è¯¦æƒ…" onclick="showStatDetails('compatibility'); event.stopPropagation();">
                <i class="fas fa-info"></i>
            </button>
            <h3 id="compatibilityRate">95%</h3>
            <p>åˆ¶é€ ä¸šé€‚é…åº¦</p>
        </div>
    </div>

    <!-- æ¨¡æ¿ç®¡ç†æŒ‰é’® -->
    <div class="text-center my-4">
        <a href="/material-workflow" class="btn btn-warning btn-lg me-3">
            <i class="fas fa-cogs me-2"></i>æ™ºèƒ½å¤„ç†å·¥ä½œæµ
        </a>
        <a href="/category-templates" class="btn btn-primary btn-lg me-3">
            <i class="fas fa-layer-group me-2"></i>æŸ¥çœ‹æ‰€æœ‰åˆ†ç±»æ¨¡æ¿
        </a>
        <a href="/smart-classification" class="btn btn-success btn-lg me-3">
            <i class="fas fa-brain me-2"></i>æ™ºèƒ½ç‰©æ–™åˆ†ç±»
        </a>
        <a href="/categories" class="btn btn-outline-secondary btn-lg">
            <i class="fas fa-sitemap me-2"></i>åˆ†ç±»ç®¡ç†
        </a>
    </div>

    <!-- æµ‹è¯•æŒ‰é’® -->
    <div class="text-center my-3">
        <button onclick="testAlert()" class="btn btn-sm btn-warning me-2">ğŸ§ª æµ‹è¯•ç‚¹å‡»åŠŸèƒ½</button>
        <button onclick="showStatDetails('total')" class="btn btn-sm btn-info">ğŸ“Š æµ‹è¯•ç»Ÿè®¡è¯¦æƒ…</button>
    </div>

    <!-- é€‚ç”¨æ€§ä¿¡æ¯ -->
    <div class="compatibility-info">
        <h5><i class="fas fa-check-circle text-success"></i> æ¨¡æ¿é€‚ç”¨æ€§è¯„ä¼°</h5>
        <div class="compatibility-item">
            <span class="text-success">âœ“</span>
            <span><strong>åˆ¶é€ ä¸šå…¨è¦†ç›–ï¼š</strong>æ¶µç›–åŒ–å·¥ã€æœºæ¢°ã€é‡‘å±ã€å»ºæç­‰ä¸»è¦åˆ¶é€ ä¸šé¢†åŸŸ</span>
        </div>
        <div class="compatibility-item">
            <span class="text-success">âœ“</span>
            <span><strong>æ ‡å‡†åŒ–åˆ†ç±»ï¼š</strong>3å±‚çº§æ¸…æ™°ç»“æ„ï¼Œä¾¿äºç²¾ç¡®åˆ†ç±»å’Œç®¡ç†</span>
        </div>
        <div class="compatibility-item">
            <span class="text-success">âœ“</span>
            <span><strong>å®ç”¨æ€§å¼ºï¼š</strong>é€‚ç”¨äºé‡‡è´­ã€åº“å­˜ã€ç”Ÿäº§ç­‰å¤šä¸ªä¸šåŠ¡åœºæ™¯</span>
        </div>
        <div class="compatibility-item">
            <span class="text-info">â„¹</span>
            <span><strong>å»ºè®®ï¼š</strong>é€‰æ‹©å‰å¯é¢„è§ˆå…·ä½“åˆ†ç±»ç»“æ„ï¼Œç¡®ä¿ç¬¦åˆä¸šåŠ¡éœ€æ±‚</span>
        </div>
    </div>

    <!-- åˆ†ç±»ç»“æ„é¢„è§ˆï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div class="preview-container" id="previewContainer" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5><i class="fas fa-sitemap"></i> åˆ†ç±»ç»“æ„é¢„è§ˆ</h5>
            <button class="btn btn-sm btn-outline-secondary" id="closePreviewBtn">
                <i class="fas fa-times"></i> å…³é—­é¢„è§ˆ
            </button>
        </div>
        
        <!-- æœç´¢æ¡† -->
        <div class="mb-3">
            <input type="text" class="form-control" id="categorySearch" 
                   placeholder="æœç´¢åˆ†ç±»åç§°æˆ–ç¼–ç ...">
        </div>
        
        <!-- åˆ†ç±»æ ‘ -->
        <div class="category-tree" id="categoryTree">
            <!-- åŠ¨æ€åŠ è½½åˆ†ç±»æ•°æ® -->
        </div>
    </div>
</div>

<!-- ç»Ÿè®¡è¯¦æƒ…æ¨¡æ€æ¡† -->
<div class="modal fade stat-details-modal" id="statDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="statDetailsTitle">
                    <i class="fas fa-chart-bar"></i> ç»Ÿè®¡è¯¦æƒ…
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
            </div>
            <div class="modal-body" id="statDetailsBody">
                <!-- åŠ¨æ€åŠ è½½ç»Ÿè®¡è¯¦æƒ… -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> å…³é—­
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ç¡®è®¤é€‰æ‹©æ¨¡æ€æ¡† -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ç¡®è®¤é€‰æ‹©åˆ†ç±»æ¨¡æ¿</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>æ‚¨å³å°†é€‰æ‹© <strong>"å·¥ä¸šåˆ¶é€ ä¸šæ ‡å‡†åˆ†ç±»ä½“ç³»"</strong> ä½œä¸ºåˆ†ç±»æ¨¡æ¿ã€‚</p>
                <p>è¯¥æ¨¡æ¿åŒ…å« <strong>548ä¸ªåˆ†ç±»</strong>ï¼Œå°†åº”ç”¨äºåç»­çš„æ™ºèƒ½åˆ†ç±»å¤„ç†ã€‚</p>
                <p class="text-muted">é€‰æ‹©åå¯ä»¥åœ¨åç»­æ­¥éª¤ä¸­æŸ¥çœ‹åˆ†ç±»ç»“æœå’Œè¿›è¡Œè°ƒæ•´ã€‚</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-success" id="confirmSelectBtn">
                    <i class="fas fa-check"></i> ç¡®è®¤é€‰æ‹©
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// æœ€ç®€å•çš„ç»Ÿè®¡è¯¦æƒ…æ˜¾ç¤ºå‡½æ•° - æ”¾åœ¨æœ€å‰é¢ç¡®ä¿ç«‹å³å¯ç”¨
function showStatDetails(type) {
    console.log('showStatDetailsè¢«è°ƒç”¨:', type);
    
    let message = '';
    switch(type) {
        case 'total':
            message = 'ğŸ“Š æ€»åˆ†ç±»æ•°è¯¦æƒ…\n\næ€»åˆ†ç±»æ•°é‡ï¼š548ä¸ª\nä¸€çº§åˆ†ç±»ï¼š18ä¸ª\näºŒçº§åˆ†ç±»ï¼š98ä¸ª\nä¸‰çº§åˆ†ç±»ï¼š432ä¸ª\n\nè¯´æ˜ï¼šæ¶µç›–åˆ¶é€ ä¸šå…¨é¢†åŸŸçš„åˆ†ç±»ä½“ç³»';
            break;
        case 'levels':
            message = 'ğŸ—ï¸ å±‚çº§ç»“æ„è¯¦æƒ…\n\nå±‚çº§æ·±åº¦ï¼š3å±‚\nç»“æ„ç±»å‹ï¼šæ ‘å½¢å±‚çº§ç»“æ„\n\nç¬¬ä¸€å±‚ï¼šä¸»è¦åˆ†ç±»ï¼ˆå¦‚ï¼šåŒ–å·¥ã€æœºæ¢°ã€é‡‘å±ç­‰ï¼‰\nç¬¬äºŒå±‚ï¼šç»†åˆ†åˆ†ç±»ï¼ˆå¦‚ï¼šåŒ–å·¥ä¸‰å‰‚ã€é€šç”¨æœºæ¢°ç­‰ï¼‰\nç¬¬ä¸‰å±‚ï¼šå…·ä½“åˆ†ç±»ï¼ˆå¦‚ï¼šé˜²çˆ†å·¥å…·ã€è½´æ‰¿ç­‰ï¼‰';
            break;
        case 'level1':
            message = 'ğŸ—‚ï¸ ä¸€çº§åˆ†ç±»è¯¦æƒ…\n\nä¸€çº§åˆ†ç±»æ•°é‡ï¼š18ä¸ª\n\nä¸»è¦åŒ…æ‹¬ï¼š\nâ€¢ A3 - åŒ–å·¥ä¸‰å‰‚ï¼šåŒ–å­¦åŸæ–™åŠåˆ¶å“\nâ€¢ AA - é€šç”¨æœºæ¢°ï¼šæœºæ¢°è®¾å¤‡åŠé›¶é…ä»¶\nâ€¢ AB - ä¸“ç”¨æœºæ¢°ï¼šä¸“ä¸šæœºæ¢°è®¾å¤‡\nâ€¢ AJ - é‡‘å±åˆ¶å“ï¼šé‡‘å±ææ–™åŠåˆ¶å“\nâ€¢ AS - é’¢æï¼šå„ç±»é’¢æäº§å“\nâ€¢ AN - å»ºå·¥ææ–™ï¼šå»ºç­‘å·¥ç¨‹ææ–™\nâ€¢ AT - å·¥å™¨å…·ï¼šå·¥å…·å™¨å…·è®¾å¤‡\nâ€¢ æ›´å¤šåˆ¶é€ ä¸šé¢†åŸŸ...';
            break;
        case 'compatibility':
            message = 'ğŸ­ åˆ¶é€ ä¸šé€‚é…åº¦è¯¦æƒ…\n\né€‚é…åº¦ï¼š95%\nè¦†ç›–é¢†åŸŸï¼š18ä¸ªä¸»è¦åˆ¶é€ ä¸šé¢†åŸŸ\n\nå„è¡Œä¸šè¦†ç›–æƒ…å†µï¼š\nâ€¢ åŒ–å·¥è¡Œä¸šï¼š100%\nâ€¢ æœºæ¢°åˆ¶é€ ï¼š98%\nâ€¢ é‡‘å±åŠ å·¥ï¼š95%\nâ€¢ å»ºç­‘ææ–™ï¼š92%\nâ€¢ å·¥å…·å™¨å…·ï¼š90%\n\nè¯¥åˆ†ç±»ä½“ç³»åŸºäºå›½å®¶æ ‡å‡†å’Œè¡Œä¸šå®è·µï¼Œå¯¹åˆ¶é€ ä¸šæœ‰å¾ˆé«˜çš„é€‚é…åº¦ã€‚';
            break;
        default:
            message = 'è¯¦æƒ…ä¿¡æ¯ï¼š' + type;
    }
    
    alert(message);
}

// æµ‹è¯•å‡½æ•°
function testAlert() {
    alert('ç‚¹å‡»åŠŸèƒ½æ­£å¸¸ï¼JavaScriptå¯ä»¥æ‰§è¡Œã€‚');
    console.log('æµ‹è¯•å‡½æ•°è¢«è°ƒç”¨');
}

// ç¡®ä¿å‡½æ•°åœ¨å…¨å±€èŒƒå›´å¯ç”¨
window.showStatDetails = showStatDetails;
window.testAlert = testAlert;

// ç«‹å³æµ‹è¯•å‡½æ•°æ˜¯å¦å¯ç”¨
console.log('JavaScriptåŠ è½½å®Œæˆï¼Œå‡½æ•°å®šä¹‰:', typeof showStatDetails);
console.log('æµ‹è¯•è°ƒç”¨showStatDetails:', showStatDetails ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨');

// å…¨å±€å˜é‡å­˜å‚¨ç»Ÿè®¡æ•°æ®
let categoryStats = {};

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOMå†…å®¹åŠ è½½å®Œæˆï¼Œå¼€å§‹ç»‘å®šäº‹ä»¶');
    
    // æµ‹è¯•åŸºæœ¬åŠŸèƒ½
    console.log('ç»Ÿè®¡å¡ç‰‡æ•°é‡:', document.querySelectorAll('.stat-card').length);
    console.log('è¯¦æƒ…æŒ‰é’®æ•°é‡:', document.querySelectorAll('.detail-btn').length);
    
    // åŠ è½½ç»Ÿè®¡æ•°æ®
    loadCategoryStatistics();
    
    // é¢„è§ˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
    const previewBtn = document.getElementById('previewBtn');
    if (previewBtn) {
        previewBtn.addEventListener('click', function() {
            console.log('é¢„è§ˆæŒ‰é’®è¢«ç‚¹å‡»');
            const container = document.getElementById('previewContainer');
            const btn = this;
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-eye-slash"></i> éšè—é¢„è§ˆ';
                btn.classList.remove('btn-outline-info');
                btn.classList.add('btn-info');
                loadCategoryTree();
            } else {
                container.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-eye"></i> é¢„è§ˆç»“æ„';
                btn.classList.remove('btn-info');
                btn.classList.add('btn-outline-info');
            }
        });
    }
    
    // å…³é—­é¢„è§ˆæŒ‰é’®
    const closePreviewBtn = document.getElementById('closePreviewBtn');
    if (closePreviewBtn) {
        closePreviewBtn.addEventListener('click', function() {
            const container = document.getElementById('previewContainer');
            const previewBtn = document.getElementById('previewBtn');
            
            container.style.display = 'none';
            previewBtn.innerHTML = '<i class="fas fa-eye"></i> é¢„è§ˆç»“æ„';
            previewBtn.classList.remove('btn-info');
            previewBtn.classList.add('btn-outline-info');
        });
    }
    
    // é€‰æ‹©æ¨¡æ¿æŒ‰é’®
    const selectTemplateBtn = document.getElementById('selectTemplateBtn');
    if (selectTemplateBtn) {
        selectTemplateBtn.addEventListener('click', function() {
            console.log('é€‰æ‹©æ¨¡æ¿æŒ‰é’®è¢«ç‚¹å‡»');
            try {
                const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
                modal.show();
            } catch (e) {
                alert('å³å°†é€‰æ‹©åˆ¶é€ ä¸šæ ‡å‡†åˆ†ç±»æ¨¡æ¿');
            }
        });
    }
    
    // ç¡®è®¤é€‰æ‹©æŒ‰é’®
    const confirmSelectBtn = document.getElementById('confirmSelectBtn');
    if (confirmSelectBtn) {
        confirmSelectBtn.addEventListener('click', function() {
            selectTemplate();
        });
    }
    
    // æœç´¢åŠŸèƒ½
    const categorySearch = document.getElementById('categorySearch');
    if (categorySearch) {
        categorySearch.addEventListener('input', function(e) {
            filterCategories(e.target.value);
        });
    }
    
    // ç»Ÿè®¡å¡ç‰‡ç‚¹å‡»äº‹ä»¶ - ä½¿ç”¨æœ€ç›´æ¥çš„æ–¹æ³•
    const statCards = document.querySelectorAll('.stat-card');
    console.log('æ‰¾åˆ°ç»Ÿè®¡å¡ç‰‡:', statCards.length);
    
    statCards.forEach(function(card, index) {
        console.log('ç»‘å®šå¡ç‰‡', index + 1, 'äº‹ä»¶');
        
        // æ·»åŠ è§†è§‰åé¦ˆ
        card.style.cursor = 'pointer';
        
        // ç‚¹å‡»äº‹ä»¶
        card.addEventListener('click', function(e) {
            console.log('å¡ç‰‡è¢«ç‚¹å‡»äº†ï¼');
            const statType = this.getAttribute('data-stat-type');
            console.log('ç»Ÿè®¡ç±»å‹:', statType);
            
            // ç›´æ¥è°ƒç”¨showStatDetails
            if (statType) {
                showStatDetails(statType);
            } else {
                alert('ç‚¹å‡»åŠŸèƒ½æ­£å¸¸ï¼Œä½†æœªæ‰¾åˆ°ç»Ÿè®¡ç±»å‹');
            }
        });
        
        // é¼ æ ‡æ•ˆæœ
        card.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f8f9fa';
            console.log('é¼ æ ‡è¿›å…¥å¡ç‰‡');
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.backgroundColor = 'white';
        });
    });
    
    // è¯¦æƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    const detailBtns = document.querySelectorAll('.detail-btn');
    console.log('æ‰¾åˆ°è¯¦æƒ…æŒ‰é’®:', detailBtns.length);
    
    detailBtns.forEach(function(btn, index) {
        console.log('ç»‘å®šæŒ‰é’®', index + 1, 'äº‹ä»¶');
        
        btn.addEventListener('click', function(e) {
            console.log('è¯¦æƒ…æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼');
            e.preventDefault();
            e.stopPropagation();
            
            const card = this.closest('.stat-card');
            if (card) {
                const statType = card.getAttribute('data-stat-type');
                console.log('æŒ‰é’®è§¦å‘ç»Ÿè®¡ç±»å‹:', statType);
                if (statType) {
                    showStatDetails(statType);
                }
            }
        });
    });
    
    console.log('æ‰€æœ‰äº‹ä»¶ç»‘å®šå®Œæˆ');
});

// åŠ è½½åˆ†ç±»æ ‘æ•°æ®
function loadCategoryTree() {
    fetch('/api/categories/tree')
        .then(response => response.json())
        .then(data => {
            renderCategoryTree(data);
        })
        .catch(error => {
            console.error('åŠ è½½åˆ†ç±»æ•°æ®å¤±è´¥:', error);
            document.getElementById('categoryTree').innerHTML = 
                '<p class="text-muted">åŠ è½½åˆ†ç±»æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚</p>';
        });
}

// æ¸²æŸ“åˆ†ç±»æ ‘
function renderCategoryTree(categories) {
    const container = document.getElementById('categoryTree');
    let html = '';
    
    // æŒ‰å±‚çº§åˆ†ç»„æ˜¾ç¤º
    const level1 = categories.filter(cat => cat.level === 1);
    
    level1.forEach(cat1 => {
        html += `
            <div class="category-item">
                <span class="category-code">${cat1.category_code}</span>
                <span class="category-name"><strong>${cat1.category_name}</strong></span>
            </div>
        `;
        
        // æ˜¾ç¤ºå‰3ä¸ªäºŒçº§åˆ†ç±»ä½œä¸ºç¤ºä¾‹
        const level2 = categories.filter(cat => cat.parent_code === cat1.category_code).slice(0, 3);
        level2.forEach(cat2 => {
            html += `
                <div class="category-item" style="padding-left: 2rem;">
                    <span class="category-code">${cat2.category_code}</span>
                    <span class="category-name">${cat2.category_name}</span>
                </div>
            `;
        });
        
        if (categories.filter(cat => cat.parent_code === cat1.category_code).length > 3) {
            html += `
                <div class="category-item" style="padding-left: 2rem; color: var(--text-muted);">
                    <span>... æ›´å¤šå­åˆ†ç±»</span>
                </div>
            `;
        }
    });
    
    container.innerHTML = html;
}

// æœç´¢è¿‡æ»¤
function filterCategories(searchTerm) {
    const items = document.querySelectorAll('.category-item');
    
    items.forEach(item => {
        const text = item.textContent.toLowerCase();
        if (text.includes(searchTerm.toLowerCase()) || !searchTerm) {
            item.style.display = 'flex';
        } else {
            item.style.display = 'none';
        }
    });
}

// é€‰æ‹©æ¨¡æ¿
function selectTemplate() {
    const templateData = {
        template_id: 'manufacturing_standard_v1',
        template_name: 'å·¥ä¸šåˆ¶é€ ä¸šæ ‡å‡†åˆ†ç±»ä½“ç³»',
        total_categories: 548,
        levels: 3,
        selected_at: new Date().toISOString()
    };
    
    fetch('/api/template/select', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(templateData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showNotification('åˆ†ç±»æ¨¡æ¿é€‰æ‹©æˆåŠŸï¼å³å°†è·³è½¬åˆ°ä¸‹ä¸€æ­¥...', 'success');
            
            // å…³é—­æ¨¡æ€æ¡†
            const modal = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
            modal.hide();
            
            // å»¶è¿Ÿè·³è½¬
            setTimeout(() => {
                window.location.href = '/extract_parameters';
            }, 1500);
        } else {
            showNotification('é€‰æ‹©å¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
        }
    })
    .catch(error => {
        console.error('é€‰æ‹©æ¨¡æ¿å¤±è´¥:', error);
        showNotification('é€‰æ‹©å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
    });
}

// åŠ è½½åˆ†ç±»ç»Ÿè®¡æ•°æ®
function loadCategoryStatistics() {
    fetch('/api/categories/detailed-statistics')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                categoryStats = data.statistics;
                updateStatCards();
            }
        })
        .catch(error => {
            console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
        });
}

// æ›´æ–°ç»Ÿè®¡å¡ç‰‡æ•°æ®
function updateStatCards() {
    if (categoryStats.total) {
        document.getElementById('totalCategories').textContent = categoryStats.total;
    }
    if (categoryStats.level_stats && categoryStats.level_stats['1']) {
        document.getElementById('level1Count').textContent = categoryStats.level_stats['1'];
    }
    if (categoryStats.compatibility_rate) {
        document.getElementById('compatibilityRate').textContent = categoryStats.compatibility_rate + '%';
    }
}

// ç®€åŒ–çš„åŠ è½½ç»Ÿè®¡æ•°æ®å‡½æ•°
function loadCategoryStatistics() {
    console.log('åŠ è½½ç»Ÿè®¡æ•°æ®...');
    // è¿™é‡Œå¯ä»¥æ·»åŠ APIè°ƒç”¨æ¥è·å–çœŸå®æ•°æ®
}

// æ˜¾ç¤ºç»Ÿè®¡è¯¦æƒ…
function showStatDetails(type) {
    console.log('æ˜¾ç¤ºç»Ÿè®¡è¯¦æƒ…:', type); // è°ƒè¯•æ—¥å¿—
    const modalElement = document.getElementById('statDetailsModal');
    const title = document.getElementById('statDetailsTitle');
    const body = document.getElementById('statDetailsBody');
    
    if (!modalElement || !title || !body) {
        console.error('æ¨¡æ€æ¡†å…ƒç´ æœªæ‰¾åˆ°');
        return;
    }
    
    let content = '';
    
    switch(type) {
        case 'total':
            title.innerHTML = '<i class="fas fa-list-ol"></i> æ€»åˆ†ç±»æ•°è¯¦æƒ…';
            content = generateTotalStatsContent();
            break;
        case 'levels':
            title.innerHTML = '<i class="fas fa-layer-group"></i> å±‚çº§ç»“æ„è¯¦æƒ…';
            content = generateLevelsContent();
            break;
        case 'level1':
            title.innerHTML = '<i class="fas fa-sitemap"></i> ä¸€çº§åˆ†ç±»è¯¦æƒ…';
            content = generateLevel1Content();
            break;
        case 'compatibility':
            title.innerHTML = '<i class="fas fa-industry"></i> åˆ¶é€ ä¸šé€‚é…åº¦è¯¦æƒ…';
            content = generateCompatibilityContent();
            break;
    }
    
    body.innerHTML = content;
    
    // ä½¿ç”¨Bootstrap 5çš„æ–¹å¼æ˜¾ç¤ºæ¨¡æ€æ¡†
    try {
        const modal = new bootstrap.Modal(modalElement);
        modal.show();
    } catch (error) {
        console.error('æ¨¡æ€æ¡†æ˜¾ç¤ºé”™è¯¯:', error);
        // é™çº§å¤„ç†ï¼šä½¿ç”¨jQueryæ–¹å¼
        if (typeof $ !== 'undefined') {
            $('#statDetailsModal').modal('show');
        } else {
            alert('è¯¦æƒ…åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        }
    }
}

// ç”Ÿæˆæ€»åˆ†ç±»ç»Ÿè®¡å†…å®¹
function generateTotalStatsContent() {
    const stats = categoryStats;
    const total = stats.total || 548;
    const level1 = stats.level_stats ? stats.level_stats['1'] : 18;
    const level2 = stats.level_stats ? stats.level_stats['2'] : 98;
    const level3 = stats.level_stats ? stats.level_stats['3'] : 432;
    
    return `
        <div class="detail-item">
            <span class="detail-label">æ€»åˆ†ç±»æ•°é‡</span>
            <span class="detail-value">${total}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">ä¸€çº§åˆ†ç±»</span>
            <span class="detail-value">${level1}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">äºŒçº§åˆ†ç±»</span>
            <span class="detail-value">${level2}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">ä¸‰çº§åˆ†ç±»</span>
            <span class="detail-value">${level3}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">å¶å­èŠ‚ç‚¹æ•°é‡</span>
            <span class="detail-value">${stats.leaf_count || level3}</span>
        </div>
        <hr>
        <h6><i class="fas fa-chart-pie"></i> åˆ†å¸ƒæ¯”ä¾‹</h6>
        <div class="progress-item">
            <div class="d-flex justify-content-between mb-1">
                <span>ä¸€çº§åˆ†ç±»</span>
                <span>${Math.round(level1 / total * 100)}%</span>
            </div>
            <div class="progress">
                <div class="progress-bar bg-primary" style="width: ${Math.round(level1 / total * 100)}%"></div>
            </div>
        </div>
        <div class="progress-item">
            <div class="d-flex justify-content-between mb-1">
                <span>äºŒçº§åˆ†ç±»</span>
                <span>${Math.round(level2 / total * 100)}%</span>
            </div>
            <div class="progress">
                <div class="progress-bar bg-success" style="width: ${Math.round(level2 / total * 100)}%"></div>
            </div>
        </div>
        <div class="progress-item">
            <div class="d-flex justify-content-between mb-1">
                <span>ä¸‰çº§åˆ†ç±»</span>
                <span>${Math.round(level3 / total * 100)}%</span>
            </div>
            <div class="progress">
                <div class="progress-bar bg-info" style="width: ${Math.round(level3 / total * 100)}%"></div>
            </div>
        </div>
    `;
}

// ç”Ÿæˆå±‚çº§ç»“æ„å†…å®¹
function generateLevelsContent() {
    return `
        <div class="detail-item">
            <span class="detail-label">å±‚çº§æ·±åº¦</span>
            <span class="detail-value">3å±‚</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">ç»“æ„ç±»å‹</span>
            <span class="detail-value">æ ‘å½¢å±‚çº§ç»“æ„</span>
        </div>
        <hr>
        <h6><i class="fas fa-tree"></i> å±‚çº§è¯´æ˜</h6>
        <div class="detail-item">
            <span class="detail-label"><i class="fas fa-circle text-primary"></i> ç¬¬ä¸€å±‚</span>
            <span class="detail-value">ä¸»è¦åˆ†ç±»ï¼ˆå¦‚ï¼šåŒ–å·¥ã€æœºæ¢°ã€é‡‘å±ç­‰ï¼‰</span>
        </div>
        <div class="detail-item">
            <span class="detail-label"><i class="fas fa-circle text-success"></i> ç¬¬äºŒå±‚</span>
            <span class="detail-value">ç»†åˆ†åˆ†ç±»ï¼ˆå¦‚ï¼šåŒ–å·¥ä¸‰å‰‚ã€é€šç”¨æœºæ¢°ç­‰ï¼‰</span>
        </div>
        <div class="detail-item">
            <span class="detail-label"><i class="fas fa-circle text-info"></i> ç¬¬ä¸‰å±‚</span>
            <span class="detail-value">å…·ä½“åˆ†ç±»ï¼ˆå¦‚ï¼šé˜²çˆ†å·¥å…·ã€è½´æ‰¿ç­‰ï¼‰</span>
        </div>
        <hr>
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            æ¯ä¸ªå±‚çº§éƒ½æœ‰æ˜ç¡®çš„åˆ†ç±»æ ‡å‡†ï¼Œç¡®ä¿ç‰©æ–™åˆ†ç±»çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚
        </div>
    `;
}

// ç”Ÿæˆä¸€çº§åˆ†ç±»å†…å®¹
function generateLevel1Content() {
    const level1Count = categoryStats.level_stats ? categoryStats.level_stats['1'] : 18;
    return `
        <div class="detail-item">
            <span class="detail-label">ä¸€çº§åˆ†ç±»æ•°é‡</span>
            <span class="detail-value">${level1Count}</span>
        </div>
        <hr>
        <h6><i class="fas fa-list"></i> ä¸»è¦ä¸€çº§åˆ†ç±»</h6>
        <div class="detail-item">
            <span class="detail-label">A3 - åŒ–å·¥ä¸‰å‰‚</span>
            <span class="detail-value">åŒ–å­¦åŸæ–™åŠåˆ¶å“</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">AA - é€šç”¨æœºæ¢°</span>
            <span class="detail-value">æœºæ¢°è®¾å¤‡åŠé›¶é…ä»¶</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">AB - ä¸“ç”¨æœºæ¢°</span>
            <span class="detail-value">ä¸“ä¸šæœºæ¢°è®¾å¤‡</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">AJ - é‡‘å±åˆ¶å“</span>
            <span class="detail-value">é‡‘å±ææ–™åŠåˆ¶å“</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">AS - é’¢æ</span>
            <span class="detail-value">å„ç±»é’¢æäº§å“</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">AN - å»ºå·¥ææ–™</span>
            <span class="detail-value">å»ºç­‘å·¥ç¨‹ææ–™</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">AT - å·¥å™¨å…·</span>
            <span class="detail-value">å·¥å…·å™¨å…·è®¾å¤‡</span>
        </div>
        <div class="detail-item" style="color: #6c757d;">
            <span class="detail-label">... å…¶ä»–åˆ†ç±»</span>
            <span class="detail-value">æ›´å¤šåˆ¶é€ ä¸šé¢†åŸŸ</span>
        </div>
    `;
}

// ç”Ÿæˆåˆ¶é€ ä¸šé€‚é…åº¦å†…å®¹
function generateCompatibilityContent() {
    const rate = categoryStats.compatibility_rate || 95;
    return `
        <div class="detail-item">
            <span class="detail-label">åˆ¶é€ ä¸šé€‚é…åº¦</span>
            <span class="detail-value">${rate}%</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">è¦†ç›–é¢†åŸŸ</span>
            <span class="detail-value">18ä¸ªä¸»è¦åˆ¶é€ ä¸šé¢†åŸŸ</span>
        </div>
        <hr>
        <h6><i class="fas fa-industry"></i> é€‚é…é¢†åŸŸè¯¦æƒ…</h6>
        <div class="progress-item">
            <div class="d-flex justify-content-between mb-1">
                <span>åŒ–å·¥è¡Œä¸š</span>
                <span>100%</span>
            </div>
            <div class="progress">
                <div class="progress-bar bg-success" style="width: 100%"></div>
            </div>
        </div>
        <div class="progress-item">
            <div class="d-flex justify-content-between mb-1">
                <span>æœºæ¢°åˆ¶é€ </span>
                <span>98%</span>
            </div>
            <div class="progress">
                <div class="progress-bar bg-success" style="width: 98%"></div>
            </div>
        </div>
        <div class="progress-item">
            <div class="d-flex justify-content-between mb-1">
                <span>é‡‘å±åŠ å·¥</span>
                <span>95%</span>
            </div>
            <div class="progress">
                <div class="progress-bar bg-success" style="width: 95%"></div>
            </div>
        </div>
        <div class="progress-item">
            <div class="d-flex justify-content-between mb-1">
                <span>å»ºç­‘ææ–™</span>
                <span>92%</span>
            </div>
            <div class="progress">
                <div class="progress-bar bg-info" style="width: 92%"></div>
            </div>
        </div>
        <div class="progress-item">
            <div class="d-flex justify-content-between mb-1">
                <span>å·¥å…·å™¨å…·</span>
                <span>90%</span>
            </div>
            <div class="progress">
                <div class="progress-bar bg-info" style="width: 90%"></div>
            </div>
        </div>
        <hr>
        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            è¯¥åˆ†ç±»ä½“ç³»åŸºäºå›½å®¶æ ‡å‡†å’Œè¡Œä¸šå®è·µï¼Œå¯¹åˆ¶é€ ä¸šæœ‰å¾ˆé«˜çš„é€‚é…åº¦ã€‚
        </div>
    `;
}

// ç”Ÿæˆç®€åŒ–ç»Ÿè®¡å†…å®¹
function generateSimpleStatsContent(type) {
    const stats = categoryStats;
    const total = stats.total || 548;
    const level1 = stats.level_stats ? stats.level_stats['1'] : 18;
    const level2 = stats.level_stats ? stats.level_stats['2'] : 98;
    const level3 = stats.level_stats ? stats.level_stats['3'] : 432;
    
    switch(type) {
        case 'total':
            return `
                <div style="padding: 20px;">
                    <h5>ğŸ“ˆ åˆ†ç±»ç»Ÿè®¡æ¦‚è§ˆ</h5>
                    <hr>
                    <p><strong>æ€»åˆ†ç±»æ•°é‡ï¼š</strong>${total}</p>
                    <p><strong>ä¸€çº§åˆ†ç±»ï¼š</strong>${level1} ä¸ª</p>
                    <p><strong>äºŒçº§åˆ†ç±»ï¼š</strong>${level2} ä¸ª</p>
                    <p><strong>ä¸‰çº§åˆ†ç±»ï¼š</strong>${level3} ä¸ª</p>
                    <hr>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <p><strong>è¯´æ˜ï¼š</strong>åˆ†ç±»ä½“ç³»æ¶µç›–åˆ¶é€ ä¸šå…¨é¢†åŸŸï¼ŒåŒ…å«åŒ–å·¥ã€æœºæ¢°ã€é‡‘å±ã€å»ºæç­‰ä¸»è¦è¡Œä¸šã€‚</p>
                    </div>
                </div>
            `;
        case 'levels':
            return `
                <div style="padding: 20px;">
                    <h5>ğŸ—ï¸ å±‚çº§ç»“æ„è¯´æ˜</h5>
                    <hr>
                    <p><strong>å±‚çº§æ·±åº¦ï¼š</strong>3å±‚</p>
                    <p><strong>ç»“æ„ç±»å‹ï¼š</strong>æ ‘å½¢å±‚çº§ç»“æ„</p>
                    <hr>
                    <div style="margin: 15px 0;">
                        <p><span style="color: #007bff;">â—</span> <strong>ç¬¬ä¸€å±‚ï¼š</strong>ä¸»è¦åˆ†ç±»ï¼ˆå¦‚ï¼šåŒ–å·¥ã€æœºæ¢°ã€é‡‘å±ç­‰ï¼‰</p>
                        <p><span style="color: #28a745;">â—</span> <strong>ç¬¬äºŒå±‚ï¼š</strong>ç»†åˆ†åˆ†ç±»ï¼ˆå¦‚ï¼šåŒ–å·¥ä¸‰å‰‚ã€é€šç”¨æœºæ¢°ç­‰ï¼‰</p>
                        <p><span style="color: #17a2b8;">â—</span> <strong>ç¬¬ä¸‰å±‚ï¼š</strong>å…·ä½“åˆ†ç±»ï¼ˆå¦‚ï¼šé˜²çˆ†å·¥å…·ã€è½´æ‰¿ç­‰ï¼‰</p>
                    </div>
                </div>
            `;
        case 'level1':
            return `
                <div style="padding: 20px;">
                    <h5>ğŸ—‚ï¸ ä¸€çº§åˆ†ç±»è¯¦æƒ…</h5>
                    <hr>
                    <p><strong>ä¸€çº§åˆ†ç±»æ•°é‡ï¼š</strong>${level1} ä¸ª</p>
                    <hr>
                    <div style="margin: 15px 0;">
                        <p><strong>A3 - åŒ–å·¥ä¸‰å‰‚ï¼š</strong>åŒ–å­¦åŸæ–™åŠåˆ¶å“</p>
                        <p><strong>AA - é€šç”¨æœºæ¢°ï¼š</strong>æœºæ¢°è®¾å¤‡åŠé›¶é…ä»¶</p>
                        <p><strong>AB - ä¸“ç”¨æœºæ¢°ï¼š</strong>ä¸“ä¸šæœºæ¢°è®¾å¤‡</p>
                        <p><strong>AJ - é‡‘å±åˆ¶å“ï¼š</strong>é‡‘å±ææ–™åŠåˆ¶å“</p>
                        <p><strong>AS - é’¢æï¼š</strong>å„ç±»é’¢æäº§å“</p>
                        <p><strong>AN - å»ºå·¥ææ–™ï¼š</strong>å»ºç­‘å·¥ç¨‹ææ–™</p>
                        <p><strong>AT - å·¥å™¨å…·ï¼š</strong>å·¥å…·å™¨å…·è®¾å¤‡</p>
                        <p style="color: #6c757d;"><em>... æ›´å¤šåˆ¶é€ ä¸šé¢†åŸŸ</em></p>
                    </div>
                </div>
            `;
        case 'compatibility':
            return `
                <div style="padding: 20px;">
                    <h5>ğŸ­ åˆ¶é€ ä¸šé€‚é…åº¦è¯´æ˜</h5>
                    <hr>
                    <p><strong>é€‚é…åº¦ï¼š</strong>95%</p>
                    <p><strong>è¦†ç›–é¢†åŸŸï¼š</strong>18ä¸ªä¸»è¦åˆ¶é€ ä¸šé¢†åŸŸ</p>
                    <hr>
                    <div style="margin: 15px 0;">
                        <p>âœ… <strong>åŒ–å·¥è¡Œä¸šï¼š</strong>100% è¦†ç›–</p>
                        <p>âœ… <strong>æœºæ¢°åˆ¶é€ ï¼š</strong>98% è¦†ç›–</p>
                        <p>âœ… <strong>é‡‘å±åŠ å·¥ï¼š</strong>95% è¦†ç›–</p>
                        <p>âœ… <strong>å»ºç­‘ææ–™ï¼š</strong>92% è¦†ç›–</p>
                        <p>âœ… <strong>å·¥å…·å™¨å…·ï¼š</strong>90% è¦†ç›–</p>
                    </div>
                    <div style="background: #d4edda; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <p style="margin: 0;"><strong>ğŸ’¡ æç¤ºï¼š</strong>è¯¥åˆ†ç±»ä½“ç³»åŸºäºå›½å®¶æ ‡å‡†å’Œè¡Œä¸šå®è·µï¼Œå¯¹åˆ¶é€ ä¸šæœ‰å¾ˆé«˜çš„é€‚é…åº¦ã€‚</p>
                    </div>
                </div>
            `;
        default:
            return '<p>æš‚æ— è¯¦ç»†ä¿¡æ¯</p>';
    }
}

// è·å–ç»Ÿè®¡è¯¦æƒ…æ–‡æœ¬ï¼ˆç”¨äºalerté™çº§æ˜¾ç¤ºï¼‰
function getStatDetailsText(type) {
    const stats = categoryStats;
    const total = stats.total || 548;
    const level1 = stats.level_stats ? stats.level_stats['1'] : 18;
    
    switch(type) {
        case 'total':
            return `æ€»åˆ†ç±»æ•°è¯¦æƒ…ï¼š\næ€»è®¡ï¼š${total}ä¸ªåˆ†ç±»\nä¸€çº§ï¼š${level1}ä¸ª\näºŒçº§ï¼š${stats.level_stats ? stats.level_stats['2'] : 98}ä¸ª\nä¸‰çº§ï¼š${stats.level_stats ? stats.level_stats['3'] : 432}ä¸ª`;
        case 'levels':
            return 'å±‚çº§ç»“æ„ï¼š3å±‚æ ‘å½¢ç»“æ„\nç¬¬ä¸€å±‚ï¼šä¸»è¦åˆ†ç±»\nç¬¬äºŒå±‚ï¼šç»†åˆ†åˆ†ç±»\nç¬¬ä¸‰å±‚ï¼šå…·ä½“åˆ†ç±»';
        case 'level1':
            return `ä¸€çº§åˆ†ç±»è¯¦æƒ…ï¼š\nå…±${level1}ä¸ªä¸€çº§åˆ†ç±»\nä¸»è¦åŒ…æ‹¬ï¼šåŒ–å·¥ä¸‰å‰‚ã€é€šç”¨æœºæ¢°ã€ä¸“ç”¨æœºæ¢°ã€é‡‘å±åˆ¶å“ã€å»ºå·¥ææ–™ã€å·¥å™¨å…·ç­‰åˆ¶é€ ä¸šå…¨é¢†åŸŸ`;
        case 'compatibility':
            return 'åˆ¶é€ ä¸šé€‚é…åº¦ï¼š95%\nè¦†ç›–18ä¸ªä¸»è¦åˆ¶é€ ä¸šé¢†åŸŸ\nåŒ…æ‹¬åŒ–å·¥ã€æœºæ¢°ã€é‡‘å±ã€å»ºæã€å·¥å…·ç­‰è¡Œä¸š';
        default:
            return 'è¯¦æƒ…ä¿¡æ¯åŠ è½½ä¸­...';
    }
}

// é€šçŸ¥æç¤º
function showNotification(message, type) {
    const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
    const html = `
        <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
    
    // æ’å…¥åˆ°é¡µé¢é¡¶éƒ¨
    const container = document.querySelector('.container-fluid');
    container.insertAdjacentHTML('afterbegin', html);
}
</script>
{% endblock %}