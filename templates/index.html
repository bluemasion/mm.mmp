{% extends "base.html" %}

{% block title %}é¦–é¡µ - ç‰©æ–™ä¸»æ•°æ®ç®¡ç†æ™ºèƒ½åº”ç”¨{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- æ¬¢è¿æ¨ªå¹… -->
        <div class="bg-gradient-primary text-white rounded p-5 mb-4">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-4 fw-bold mb-3" style="color: #fff; text-shadow: 0 0 10px #007bff, 0 0 20px #007bff;">ç‰©æ–™ä¸»æ•°æ®ç®¡ç†æ™ºèƒ½åº”ç”¨</h1>
                    <p class="lead mb-0">
                        è‡ªåŠ¨åŒ–ç‰©æ–™ä¿¡æ¯æå–ã€æ™ºèƒ½åˆ†ç±»æ¨èã€æ¨¡ç³ŠåŒ¹é…å»é‡ï¼Œ
                        æå‡ç‰©æ–™ä¸»æ•°æ®æ ‡å‡†åŒ–æ°´å¹³ï¼Œé™ä½äººå·¥å½•å…¥æˆæœ¬ã€‚
                    </p>
                </div>
                <div class="col-lg-4 text-center">
                    <i class="fas fa-robot fa-5x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- å¿«é€Ÿå¼€å§‹ -->
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-rocket text-primary"></i> å¿«é€Ÿå¼€å§‹
                </h5>
            </div>
            <div class="card-body">
                <!-- å¿«é€Ÿå¤„ç†å…¥å£ -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="bg-gradient-primary text-white rounded p-4 mb-4">
                            <div class="row align-items-center">
                                <div class="col-lg-8">
                                    <h5 class="fw-bold mb-2" style="color: #fff;">ğŸš€ å¿«é€Ÿå¼€å§‹</h5>
                                    <p class="mb-3 opacity-90">é€‰æ‹©æ‚¨çš„ä½¿ç”¨åœºæ™¯ï¼Œå¿«é€Ÿå¼€å§‹ç‰©æ–™åˆ†ç±»å¤„ç†</p>
                                    <div class="d-flex gap-3">
                                        <a href="/single-fuzzy-matching" class="btn btn-light btn-lg">
                                            <i class="fas fa-search text-danger"></i> å•ç‰©æ–™å¤„ç†
                                            <small class="d-block text-muted">å³æ—¶åˆ†ç±»æ¨è</small>
                                        </a>
                                        <a href="/material-workflow" class="btn btn-outline-light btn-lg">
                                            <i class="fas fa-tasks"></i> æ‰¹é‡å¤„ç†
                                            <small class="d-block opacity-75">å¤§é‡æ•°æ®å¤„ç†</small>
                                        </a>
                                    </div>
                                </div>
                                <div class="col-lg-4 text-center">
                                    <i class="fas fa-magic fa-4x opacity-75"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <!-- æ­¥éª¤1ï¼šæ•°æ®å¯¼å…¥ -->
                    <div class="col-md-6 mb-4">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <span class="fw-bold">1</span>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="fw-bold">æ•°æ®å¯¼å…¥</h6>
                                <p class="text-muted small mb-2">ä¸Šä¼ Excelæ–‡ä»¶æˆ–è¿æ¥æ•°æ®åº“ï¼Œå¯¼å…¥å¾…å¤„ç†çš„ç‰©æ–™æ•°æ®</p>
                                <a href="{{ url_for('upload_page') }}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-upload"></i> å¼€å§‹å¯¼å…¥
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤2ï¼šé€‰æ‹©åˆ†ç±»æ¨¡æ¿ -->
                    <div class="col-md-6 mb-4">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <span class="fw-bold">2</span>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="fw-bold">é€‰æ‹©åˆ†ç±»æ¨¡æ¿</h6>
                                <p class="text-muted small mb-2">é€‰æ‹©é€‚åˆçš„åˆ†ç±»ä½“ç³»ï¼Œå¦‚åˆ¶é€ ä¸šæ ‡å‡†åˆ†ç±»ç­‰</p>
                                <a href="{{ url_for('template_selection') }}" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-tags"></i> é€‰æ‹©æ¨¡æ¿
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤3ï¼šå‚æ•°æå– -->
                    <div class="col-md-6 mb-4">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <span class="fw-bold">3</span>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="fw-bold">å‚æ•°æå–</h6>
                                <p class="text-muted small mb-2">æ™ºèƒ½åˆ†è¯ï¼Œæå–å“ç‰Œã€è§„æ ¼ã€å‹å·ç­‰å…³é”®å‚æ•°</p>
                                <button class="btn btn-outline-info btn-sm" disabled>
                                    <i class="fas fa-cogs"></i> è‡ªåŠ¨æå–
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤4ï¼šåˆ†ç±»æ¨è -->
                    <div class="col-md-6 mb-4">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="bg-warning text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <span class="fw-bold">4</span>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="fw-bold">æ™ºèƒ½åˆ†ç±»</h6>
                                <p class="text-muted small mb-2">åŸºäºé€‰å®šæ¨¡æ¿å’Œæå–å‚æ•°ï¼Œæ™ºèƒ½æ¨èç‰©æ–™åˆ†ç±»</p>
                                <button class="btn btn-outline-warning btn-sm" disabled>
                                    <i class="fas fa-robot"></i> æ™ºèƒ½åˆ†ç±»
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤5ï¼šè¡¨å•ç”Ÿæˆ -->
                    <div class="col-md-6 mb-4">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <span class="fw-bold">5</span>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="fw-bold">è¡¨å•ç”Ÿæˆ</h6>
                                <p class="text-muted small mb-2">æ ¹æ®åˆ†ç±»ç”ŸæˆåŠ¨æ€è¡¨å•ï¼Œè‡ªåŠ¨å¡«å……å·²æå–çš„å‚æ•°</p>
                                <button class="btn btn-outline-success btn-sm" disabled>
                                    <i class="fas fa-wpforms"></i> ç”Ÿæˆè¡¨å•
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤6ï¼šæ¨¡ç³ŠåŒ¹é… -->
                    <div class="col-md-6 mb-4">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="bg-danger text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <span class="fw-bold">6</span>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="fw-bold">æ™ºèƒ½å¯¹ç </h6>
                                <p class="text-muted small mb-2">ä¸å·²å‘å¸ƒç‰©æ–™æ•°æ®è¿›è¡Œæ™ºèƒ½åŒ¹é…ï¼Œé¿å…é‡å¤</p>
                                <button class="btn btn-outline-danger btn-sm" disabled>
                                    <i class="fas fa-search"></i> æ‰§è¡ŒåŒ¹é…
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤6ï¼šå†³ç­–ç¡®è®¤ -->
                    <div class="col-md-6 mb-4">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="bg-dark text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <span class="fw-bold">6</span>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="fw-bold">å†³ç­–ç¡®è®¤</h6>
                                <p class="text-muted small mb-2">æŸ¥çœ‹åŒ¹é…ç»“æœï¼Œå†³å®šæ–°å¢ã€æ›´æ–°æˆ–åºŸå¼ƒ</p>
                                <button class="btn btn-outline-dark btn-sm" disabled>
                                    <i class="fas fa-check-circle"></i> ç¡®è®¤å†³ç­–
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç³»ç»Ÿç»Ÿè®¡ -->
    <div class="col-lg-4">
        <!-- åˆ†ç±»æ¨¡æ¿çŠ¶æ€ -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-tags text-secondary"></i> åˆ†ç±»æ¨¡æ¿
                </h5>
                <a href="{{ url_for('template_selection') }}" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-cog"></i> ç®¡ç†
                </a>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-gradient-secondary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                        <i class="fas fa-sitemap"></i>
                    </div>
                    <div>
                        <h6 class="mb-1" id="templateName">åˆ¶é€ ä¸šæ ‡å‡†åˆ†ç±»</h6>
                        <small class="text-muted" id="templateInfo">3å±‚çº§ç»“æ„ Â· 548ä¸ªåˆ†ç±»</small>
                    </div>
                </div>
                <div class="progress mb-2" style="height: 6px;">
                    <div class="progress-bar bg-secondary" role="progressbar" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">æ¨¡æ¿å®Œæ•´åº¦: 85%</small>
                <div class="mt-3">
                    <div class="d-flex justify-content-between small text-muted mb-1">
                        <span>ä¸€çº§åˆ†ç±»</span>
                        <span id="level1Count">18</span>
                    </div>
                    <div class="d-flex justify-content-between small text-muted mb-1">
                        <span>äºŒçº§åˆ†ç±»</span>
                        <span id="level2Count">98</span>
                    </div>
                    <div class="d-flex justify-content-between small text-muted">
                        <span>ä¸‰çº§åˆ†ç±»</span>
                        <span id="level3Count">432</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-bar text-success"></i> ç³»ç»Ÿç»Ÿè®¡
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6 mb-3">
                        <div class="bg-light rounded p-3">
                            <h4 class="text-primary mb-1" id="masterDataCount">--</h4>
                            <small class="text-muted">ä¸»æ•°æ®è®°å½•</small>
                        </div>
                    </div>
                    <div class="col-6 mb-3">
                        <div class="bg-light rounded p-3">
                            <h4 class="text-info mb-1" id="todayProcessed">--</h4>
                            <small class="text-muted">ä»Šæ—¥å¤„ç†</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="bg-light rounded p-3">
                            <h4 class="text-warning mb-1" id="pendingReview">--</h4>
                            <small class="text-muted">å¾…å®¡æ ¸</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="bg-light rounded p-3">
                            <h4 class="text-success mb-1" id="matchAccuracy">--</h4>
                            <small class="text-muted">åŒ¹é…å‡†ç¡®ç‡</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½å¯¼èˆª -->
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-th-large text-info"></i> åŠŸèƒ½å¯¼èˆª
                </h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <a href="/single-fuzzy-matching" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-search text-danger"></i>
                            <span class="ms-2">å•ç‰©æ–™åŒ¹é…</span>
                        </div>
                        <i class="fas fa-chevron-right text-muted"></i>
                    </a>
                    <a href="{{ url_for('matching_page') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-brain text-info"></i>
                            <span class="ms-2">æ•°æ®åŒ¹é…è®¡ç®—</span>
                        </div>
                        <i class="fas fa-chevron-right text-muted"></i>
                    </a>
                    <a href="{{ url_for('upload_page') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-upload text-primary"></i>
                            <span class="ms-2">æ•°æ®å¯¼å…¥</span>
                        </div>
                        <i class="fas fa-chevron-right text-muted"></i>
                    </a>
                    <a href="{{ url_for('template_selection') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-tags text-secondary"></i>
                            <span class="ms-2">åˆ†ç±»æ¨¡æ¿</span>
                        </div>
                        <i class="fas fa-chevron-right text-muted"></i>
                    </a>
                    <a href="{{ url_for('batch_management') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-tasks text-success"></i>
                            <span class="ms-2">æ‰¹é‡ç®¡ç†</span>
                        </div>
                        <i class="fas fa-chevron-right text-muted"></i>
                    </a>
                    <a href="#" onclick="checkSystemStatus(); return false;" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-cog text-warning"></i>
                            <span class="ms-2">ç³»ç»Ÿè®¾ç½®</span>
                        </div>
                        <i class="fas fa-chevron-right text-muted"></i>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-chart-line text-info"></i>
                            <span class="ms-2">ç»Ÿè®¡æŠ¥å‘Š</span>
                        </div>
                        <i class="fas fa-chevron-right text-muted"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- æœ€è¿‘å¤„ç†è®°å½• -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-history text-secondary"></i> æœ€è¿‘å¤„ç†è®°å½•
                </h5>
                <button class="btn btn-outline-secondary btn-sm" onclick="refreshRecentRecords()">
                    <i class="fas fa-refresh"></i> åˆ·æ–°
                </button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>å¤„ç†æ—¶é—´</th>
                                <th>æ•°æ®æ¥æº</th>
                                <th>å¤„ç†æ•°é‡</th>
                                <th>åŒ¹é…æˆåŠŸ</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="recentRecordsTable">
                            <tr>
                                <td colspan="6" class="text-center text-muted">
                                    <i class="fas fa-inbox"></i> æš‚æ— å¤„ç†è®°å½•
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // åŠ è½½ç³»ç»Ÿç»Ÿè®¡æ•°æ®
    loadSystemStats();
    
    // åŠ è½½åˆ†ç±»æ¨¡æ¿ä¿¡æ¯
    loadTemplateInfo();
    
    // åŠ è½½æœ€è¿‘å¤„ç†è®°å½•
    loadRecentRecords();
});

function loadSystemStats() {
    // æ¨¡æ‹Ÿç»Ÿè®¡æ•°æ®ï¼ˆå®é™…åº”è¯¥ä»APIè·å–ï¼‰
    $('#masterDataCount').text('12,345');
    $('#todayProcessed').text('89');
    $('#pendingReview').text('23');
    $('#matchAccuracy').text('95.2%');
}

function loadTemplateInfo() {
    // ä»APIè·å–åˆ†ç±»æ¨¡æ¿ç»Ÿè®¡ä¿¡æ¯
    $.get('/api/categories/stats')
        .done(function(data) {
            if (data.success) {
                const stats = data.statistics;
                $('#templateName').text('åˆ¶é€ ä¸šæ ‡å‡†åˆ†ç±»æ¨¡æ¿');
                $('#templateInfo').text(`3å±‚çº§ç»“æ„ Â· ${stats.total}ä¸ªåˆ†ç±»`);
                $('#level1Count').text(stats.level1);
                $('#level2Count').text(stats.level2);  
                $('#level3Count').text(stats.level3);
                
                // è®¡ç®—æ¨¡æ¿å®Œæ•´åº¦ï¼ˆåŸºäºåˆ†ç±»æ•°é‡çš„ç™¾åˆ†æ¯”ï¼‰
                const completeness = Math.min(100, (stats.total / 600 * 100));
                $('.progress-bar').css('width', completeness + '%').attr('aria-valuenow', completeness);
                $('.progress').next('small').text(`æ¨¡æ¿å®Œæ•´åº¦: ${completeness.toFixed(0)}%`);
            }
        })
        .fail(function() {
            // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®
            $('#templateName').text('åˆ¶é€ ä¸šæ ‡å‡†åˆ†ç±»æ¨¡æ¿');
            $('#templateInfo').text('3å±‚çº§ç»“æ„ Â· 548ä¸ªåˆ†ç±»');
            $('#level1Count').text('18');
            $('#level2Count').text('98');
            $('#level3Count').text('432');
        });
}

function loadRecentRecords() {
    // æ¨¡æ‹Ÿæœ€è¿‘å¤„ç†è®°å½•ï¼ˆå®é™…åº”è¯¥ä»APIè·å–ï¼‰
    const sampleRecords = [
        {
            timestamp: '2024-03-15 14:30:25',
            source: 'Excelå¯¼å…¥',
            total: 156,
            matched: 142,
            status: 'å·²å®Œæˆ'
        },
        {
            timestamp: '2024-03-15 10:15:10',
            source: 'æ•°æ®åº“åŒæ­¥',
            total: 89,
            matched: 85,
            status: 'å·²å®Œæˆ'
        },
        {
            timestamp: '2024-03-14 16:45:30',
            source: 'Excelå¯¼å…¥',
            total: 234,
            matched: 201,
            status: 'å¾…å®¡æ ¸'
        }
    ];
    
    let tableHtml = '';
    sampleRecords.forEach(function(record) {
        let statusClass = record.status === 'å·²å®Œæˆ' ? 'success' : 
                         record.status === 'å¾…å®¡æ ¸' ? 'warning' : 'secondary';
        
        tableHtml += `
            <tr>
                <td>${record.timestamp}</td>
                <td><i class="fas fa-file-excel text-success"></i> ${record.source}</td>
                <td>${record.total}</td>
                <td>${record.matched} <small class="text-muted">(${(record.matched/record.total*100).toFixed(1)}%)</small></td>
                <td><span class="badge bg-${statusClass}">${record.status}</span></td>
                <td>
                    <button class="btn btn-outline-primary btn-sm" onclick="viewDetails('${record.timestamp}')">
                        <i class="fas fa-eye"></i> æŸ¥çœ‹
                    </button>
                </td>
            </tr>
        `;
    });
    
    $('#recentRecordsTable').html(tableHtml);
}

function refreshRecentRecords() {
    showLoading('æ­£åœ¨åˆ·æ–°è®°å½•...');
    setTimeout(function() {
        loadRecentRecords();
        hideLoading();
        showSuccessMessage('è®°å½•å·²åˆ·æ–°');
    }, 1000);
}

function viewDetails(timestamp) {
    alert('æŸ¥çœ‹è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­ï¼š' + timestamp);
}
</script>
{% endblock %}
