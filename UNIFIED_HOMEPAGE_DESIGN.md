# 统一首页入口架构设计文档

**设计日期**: 2025-11-13  
**设计目标**: 将分散的3个入口整合为统一首页,以批量处理为核心,提供模块化功能访问

---

## 一、现状分析

### 当前入口分散问题
```
❌ 现状:
首页 (/)  ──┐
            ├──→ 批量处理 (/material-workflow)
            ├──→ 单物料处理 (/single-fuzzy-matching)
            └──→ 旧版6步流程 (/upload → /extract_parameters → ...)

问题:
1. 用户需要记住3个不同URL
2. 功能入口不直观,需要多次跳转
3. 批量处理是核心功能但入口隐藏较深
```

### 用户使用数据
- **批量处理**: 80%+ 使用频率 (核心场景)
- **单物料查询**: 15% 使用频率 (快速验证)
- **系统管理**: 5% 使用频率 (管理员操作)

---

## 二、新架构设计

### 统一首页布局原型

```
┌─────────────────────────────────────────────────────────────────────┐
│  🏠 MMP物料主数据管理系统                    [系统状态] [帮助] [设置] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ╔═══════════════════════════════════════════════════════════════╗  │
│  ║  📊 物料主数据智能管理平台                                    ║  │
│  ║  智能分类 · 模糊匹配 · 批量处理                               ║  │
│  ╚═══════════════════════════════════════════════════════════════╝  │
│                                                                       │
├───────────────────────────────────────┬───────────────────────────────┤
│                                       │                               │
│  【模块1: 批量处理 - 核心功能】      │  【模块2: 快速查询】         │
│  ┌─────────────────────────────────┐ │  ┌─────────────────────────┐ │
│  │ 🚀 批量物料处理                 │ │  │ ⚡ 单物料即时查询        │ │
│  ├─────────────────────────────────┤ │  ├─────────────────────────┤ │
│  │                                 │ │  │                         │ │
│  │ 📂 上传Excel文件                │ │  │ 📝 输入物料名称         │ │
│  │    ┗━ 拖拽上传或点击选择        │ │  │    ┗━ 实时搜索建议      │ │
│  │    ┗━ 支持2000+物料/次          │ │  │                         │ │
│  │                                 │ │  │ 🎯 智能分类推荐         │ │
│  │ ⚙️ 处理配置                     │ │  │    置信度: 85%          │ │
│  │    □ 启用物料识别               │ │  │    推荐类目: 3个        │ │
│  │    □ 相似物料匹配               │ │  │                         │ │
│  │    匹配阈值: [====•===] 60%    │ │  │ 🔍 相似物料匹配         │ │
│  │                                 │ │  │    匹配数: 5个          │ │
│  │ 📊 当前状态                     │ │  │    阈值: 70%            │ │
│  │    处理进度: ████████░░ 80%    │ │  │                         │ │
│  │    成功: 1600 | 失败: 0        │ │  │ [立即查询] [重置]       │ │
│  │                                 │ │  │                         │ │
│  │ [开始批量处理] [查看历史]       │ │  │ 📈 今日查询: 127次      │ │
│  │                                 │ │  │                         │ │
│  └─────────────────────────────────┘ │  └─────────────────────────┘ │
│                                       │                               │
├───────────────────────────────────────┴───────────────────────────────┤
│                                                                       │
│  【模块3: 系统管理与监控】 ▼ 展开                                    │
│  ┌────────────────┬────────────────┬────────────────┬──────────────┐ │
│  │ 📋 类目映射    │ 📊 算法性能    │ 📜 处理历史    │ ⚙️ 系统配置  │ │
│  ├────────────────┼────────────────┼────────────────┼──────────────┤ │
│  │ 覆盖率: 81.3%  │ 分类准确: 85%  │ 今日: 45批次   │ 数据库连接   │ │
│  │ 映射数: 4条    │ 识别置信: 69%  │ 本周: 312批次  │ 模板管理     │ │
│  │ [管理]         │ [优化]         │ [查看]         │ [设置]       │ │
│  └────────────────┴────────────────┴────────────────┴──────────────┘ │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 三、核心功能流程图

### 3.1 批量处理流程 (核心场景)

```
用户操作                    系统处理                     算法引擎
───────────────────────────────────────────────────────────────────────

【步骤1: 文件上传】
┌─────────────┐
│ 上传Excel   │──→  验证文件格式  ──→  创建Session
│ 2000条物料  │     ├─ .xlsx/.xls        └─ 生成session_id
└─────────────┘     └─ 列名映射检查
      │
      ↓
【步骤2: 数据预处理】
                    ┌────────────────┐
                    │ 数据清洗       │──→  MaterialRecognizer
                    │ ├─ 去重         │     └─ 识别16种物料类型
                    │ ├─ 格式标准化   │         (当前69%置信度)
                    │ └─ 分词提取     │
                    └────────────────┘
      │                    │
      ↓                    ↓
【步骤3: 智能分类】
                    ┌────────────────┐
                    │ 批量分类       │──→  EnhancedSmartClassifier
                    │ ├─ TF-IDF向量化 │     ├─ 544个标准类目
                    │ ├─ 语义匹配     │     ├─ 85%准确率
                    │ └─ 置信度计算   │     └─ Top-3推荐
                    └────────────────┘
      │                    │
      ↓                    ↓
【步骤4: 相似物料匹配】
                    ┌────────────────┐
                    │ 模糊匹配       │──→  SimilarMaterialMatcher
                    │ ├─ 与2000条库存 │     ├─ 模糊算法(fuzz)
                    │ │   数据比对    │     ├─ 阈值可调30-80%
                    │ ├─ 去重建议     │     └─ 90%准确率
                    │ └─ 新增/更新判断│
                    └────────────────┘
      │                    │
      ↓                    ↓
【步骤5: 类目映射】
                    ┌────────────────┐
                    │ 标准化映射     │──→  CategoryMapping查询
                    │ ├─ 4条P0映射    │     └─ 81.3%覆盖率
                    │ │   (覆盖81.3%) │         (目标95%)
                    │ └─ 未映射标记   │
                    └────────────────┘
      │                    │
      ↓                    ↓
【步骤6: 结果导出】
┌─────────────┐    ┌────────────────┐
│ 下载Excel   │←─  │ 生成结果文件   │
│ ├─ 分类结果 │    │ ├─ 推荐类目     │
│ ├─ 匹配结果 │    │ ├─ 相似物料     │
│ ├─ 置信度   │    │ ├─ 处理状态     │
│ └─ 异常标记 │    │ └─ 决策建议     │
└─────────────┘    └────────────────┘

性能指标:
├─ 处理速度: 2000条/5-8分钟
├─ 分类准确率: 85%
├─ 匹配准确率: 90%
└─ 映射覆盖率: 81.3% (待优化→95%)
```

---

### 3.2 单物料快速查询流程

```
用户输入                系统响应              算法处理
─────────────────────────────────────────────────────

输入: "不锈钢螺栓M8"
      │
      ↓
   [实时搜索]  ──→  分词提取  ──→  ┌──────────────┐
                    ├─ 不锈钢         │ 物料识别     │
                    ├─ 螺栓           │ └─ 金属类    │
                    └─ M8             │   置信69%    │
                                      └──────────────┘
      │                                      │
      ↓                                      ↓
   [智能分类]  ──→  类目推荐  ←──  ┌──────────────┐
                    ├─ 紧固件          │ TF-IDF匹配  │
                    │   (85%置信)      │ 544类目库   │
                    ├─ 标准件          │ Top-3推荐   │
                    │   (78%置信)      └──────────────┘
                    └─ 五金工具
                        (65%置信)
      │
      ↓
   [相似匹配]  ──→  匹配结果  ←──  ┌──────────────┐
                    ├─ 不锈钢螺栓M10   │ 模糊匹配    │
                    │   (92%相似)      │ 阈值70%     │
                    ├─ 304螺栓M8      │ 2000条库存  │
                    │   (88%相似)      └──────────────┘
                    └─ 碳钢螺栓M8
                        (75%相似)
      │
      ↓
   显示结果
   ├─ 推荐类目: 紧固件
   ├─ 相似物料: 3个
   ├─ 决策建议: 可能重复
   └─ 响应时间: <500ms

特点:
├─ 无需上传文件
├─ 即时反馈
├─ 适合临时验证
└─ 单次查询
```

---

## 四、重要功能对照表

### 4.1 核心算法功能

| 功能模块 | 当前状态 | 性能指标 | 优化目标 | 优先级 |
|---------|---------|---------|---------|-------|
| **智能分类** | ✅ 已实现 | 85%准确率 | 维持 | P0 |
| **物料识别** | ⚠️ 需优化 | 69%置信度 | →92% | P0 |
| **相似匹配** | ✅ 已实现 | 90%准确率 | 维持 | P0 |
| **类目映射** | ⚠️ 需扩展 | 81.3%覆盖 | →95% | P1 |
| **批量处理** | ✅ 已实现 | 2000条/次 | 维持 | P0 |
| **实时推荐** | ✅ 已实现 | <500ms | 维持 | P1 |

### 4.2 功能模块映射

| 旧入口 | 新模块位置 | 状态 | 说明 |
|-------|-----------|-----|------|
| `/` (首页) | 统一首页 | ✅ 保留 | 重构为模块化布局 |
| `/material-workflow` | 首页-模块1 | 🔄 合并 | 嵌入首页批量处理区 |
| `/single-fuzzy-matching` | 首页-模块2 | 🔄 合并 | 嵌入首页快速查询区 |
| `/upload` | - | ❌ 废弃 | 旧版6步流程入口 |
| `/extract_parameters` | - | ❌ 废弃 | 旧版参数提取页 |
| `/category_selection` | - | ❌ 废弃 | 旧版分类选择页 |
| `/matching` | - | ❌ 废弃 | 旧版匹配页 |
| `/decision` | - | ❌ 废弃 | 旧版决策页 |

### 4.3 API接口保留

| API路径 | 功能 | 状态 | 调用方式 |
|--------|------|-----|---------|
| `/api/material-workflow/process` | 批量处理 | ✅ 保留 | 模块1调用 |
| `/api/single-fuzzy-matching` | 单物料查询 | ✅ 保留 | 模块2调用 |
| `/api/intelligent_recommend` | 智能推荐 | ✅ 保留 | 两模块共用 |
| `/api/category_features/<id>` | 类目特征 | ✅ 保留 | 系统管理调用 |

---

## 五、数据流程图

### 5.1 统一数据处理架构

```
┌─────────────────────────────────────────────────────────────┐
│                      统一首页入口                            │
└────────────┬──────────────────────────┬─────────────────────┘
             │                          │
             │                          │
    ┌────────▼────────┐        ┌───────▼────────┐
    │  批量处理模块    │        │ 单物料查询模块  │
    │  (n=1~2000)     │        │  (n=1)          │
    └────────┬────────┘        └───────┬────────┘
             │                          │
             └──────────┬───────────────┘
                        │
                        ▼
        ┌───────────────────────────────────┐
        │   MaterialWorkflowService         │
        │   (统一处理服务)                  │
        ├───────────────────────────────────┤
        │  ├─ SessionDataManager            │
        │  ├─ EnhancedSmartClassifier       │
        │  ├─ MaterialRecognizer            │
        │  └─ SimilarMaterialMatcher        │
        └────────┬──────────────────────────┘
                 │
     ┌───────────┼───────────┐
     │           │           │
     ▼           ▼           ▼
┌─────────┐ ┌─────────┐ ┌─────────┐
│business │ │sessions │ │ master  │
│_data.db │ │  .db    │ │_data.db │
│(2000条) │ │(会话)   │ │(544类目)│
└─────────┘ └─────────┘ └─────────┘
```

---

## 六、实施计划

### Phase 1: 首页重构 (1-2天)
- [ ] 创建新的 `index_v2.html` 模块化布局
- [ ] 实现Tab切换或区域分割
- [ ] 保留原 `index.html` 作为备份

### Phase 2: 功能整合 (1天)
- [ ] 批量处理UI嵌入首页模块1
- [ ] 单物料查询UI嵌入首页模块2
- [ ] 系统管理折叠区实现

### Phase 3: 路由优化 (0.5天)
- [ ] 调整 `web_app.py` 路由
- [ ] 标记旧路由为 `@deprecated`
- [ ] 添加重定向规则

### Phase 4: 测试验证 (0.5天)
- [ ] 功能完整性测试
- [ ] 性能对比测试
- [ ] 用户体验验证

---

## 七、关键决策点

### 需要确认的设计细节

1. **批量处理模块布局**
   - 选项A: 垂直布局(上传→配置→执行)
   - 选项B: 横向步骤条(类似当前material-workflow)
   - **建议**: 选项A,更直观

2. **单物料查询响应方式**
   - 选项A: 模态框弹出结果
   - 选项B: 右侧面板显示
   - **建议**: 选项B,便于对比

3. **旧功能保留策略**
   - 选项A: 完全删除旧路由
   - 选项B: 保留6个月并添加迁移提示
   - **建议**: 选项B,平滑过渡

4. **系统管理模块展示**
   - 选项A: 默认折叠,点击展开
   - 选项B: 始终显示在底部
   - **建议**: 选项A,减少页面拥挤

---

## 八、成功指标

### 用户体验指标
- ✅ 首页加载时间 < 1秒
- ✅ 批量处理入口点击≤1次
- ✅ 单物料查询响应 < 500ms
- ✅ 减少80%页面跳转

### 技术指标
- ✅ 代码复用率提升50%
- ✅ 路由数量减少40%
- ✅ Session管理统一化
- ✅ API调用路径简化

---

## 附录: 线框图说明

### 响应式布局适配

**桌面端 (>1200px)**
```
[批量处理 60%] [快速查询 40%]
[系统管理 100%折叠]
```

**平板端 (768-1200px)**
```
[批量处理 100%]
[快速查询 100%]
[系统管理 100%折叠]
```

**移动端 (<768px)**
```
[Tab切换]
├─ 批量处理
├─ 快速查询
└─ 系统管理
```

---

**下一步**: 请确认以上设计方案,我将开始实施Phase 1的首页重构工作。
